name: Generate Metrics (isocalendar + languages + summary)

on:
  schedule:
    - cron: "0 1 * * *"   # Daily 01:00 UTC
  workflow_dispatch: {}
  push:
    branches:
      - main

jobs:
  generate-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      # ============================================================
      # === ISOCALENDAR (Isometric Contribution Calendar)
      # ============================================================
      - name: Generate isocalendar SVG
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          committer_token: ${{ secrets.METRICS_TOKEN }}
          committer_branch: main
          filename: metrics.plugin.isocalendar.svg
          template: classic
          base: ""
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year

      # ============================================================
      # === LANGUAGES (Most Used Languages)
      # ============================================================
      - name: Generate languages SVG
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          committer_token: ${{ secrets.METRICS_TOKEN }}
          committer_branch: main
          filename: metrics.plugin.languages.svg
          template: classic
          base: ""
          plugin_languages: yes
          plugin_languages_limit: 8
          plugin_languages_sections: most-used
          plugin_languages_details: percentage,bytes-size

      # ============================================================
      # === SUMMARY CARD (VALID PLUGINS)
      # ============================================================
      - name: Generate main metrics SVG (summary)
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          committer_token: ${{ secrets.METRICS_TOKEN }}
          committer_branch: main
          filename: metrics.svg
          template: classic
          base: ""

          plugin_followup: yes
          plugin_repositories: yes
          plugin_activity: yes
          plugin_achievements: yes
          plugin_people: yes

      # ============================================================
      # === ANILIST FAVORITES (Anime List)
      # ============================================================
      - name: Generate AniList favorites SVG
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}
          committer_token: ${{ secrets.METRICS_TOKEN }}
          committer_branch: main
          filename: metrics.plugin.anilist.svg
          template: classic
          base: ""
          plugin_anilist: yes
          plugin_anilist_user: SpaceLeam
          plugin_anilist_sections: favorites
          plugin_anilist_medias: anime
          plugin_anilist_limit: 12
